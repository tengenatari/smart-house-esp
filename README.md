# smart-house-esp

Проект по эмуляции умного дома с использованием ESP32, HTTP и WOKWI.

Запуск проекта
```
docker-compose up -d --build
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
```

<!-- [[[cog
import cog

content = open("./src/devices/README.md").read()
open_pattern = "--!<"
close_pattern = ">--"

open_pattern = open_pattern[::-1]
close_pattern = close_pattern[::-1]

while (content.find(open_pattern) != -1):
    content = content[:content.find(open_pattern)] + content[content.find(close_pattern)+len(close_pattern):]

cog.out(content)
]]] -->
# Devices
Каталог контроллеров и датчиков. Настройки и код.


### Модуль управления реле

#### Схема цепи

[Проект Wokwi](https://wokwi.com/projects/456035055362315265)

![Схема цепи](/src/devices/relay/docs/circuit.png)

#### Описание

Для управления реле и связи с облачным сервером спользуется микроконтроллер ESP-32. 

Для индикации наличия связи с сервером используется залёный светодиод, подключённый к 0 цифровому пину ESP-32.

Реле имитирует исполняющие устройства, которые отсутствуют в эмуляции Wokwi. Реле подключено к 4 цифровому пину ESP-32.

#### Взаимодействие с сервером

Во время эмуляции микроконтроллер подключается к Wifi-сети, отправляет HTTP-запросы к серверу. В запросах отправляется текущее состояние реле. В качестве ответа получаем состояние, которое необходимо установить.

**Формат запросов:**

HTTP POST 

URL: /api/v1/имя_исполняющего_устройства/id

body:
```
{
    "active": true
}
```

**Формат ответов:**

HTTP 200 

body:
```
{
    "active": true
}
```



### Модуль температуры и влажности

#### Схема цепи

[Проект Wokwi](https://wokwi.com/projects/456108578902750209)

![Схема цепи](/src/devices/dht22/docs/circuit.png)

#### Описание

Для считывания показаний и связи с облачным сервером спользуется микроконтроллер ESP-32. 

Для индикации наличия связи с сервером используется залёный светодиод, подключённый к 0 цифровому пину ESP-32.

Датчик температуры и влажности подключён к 4 цифровому пину ESP-32.

Жидкокристаллический дисплей служит для вывода показаний датчика, для вывода значений на экран используется шина I2C (21 и 22 пины).

#### Взаимодействие с сервером

Во время эмуляции микроконтроллер подключается к Wifi-сети, отправляет HTTP-запросы к серверу. В запросах отправляется текущее состояние датчика. Температура передаётся в целочисленном формате с учётом двух разрядов дробной части, например 2500 означает 25,00 градусов цельсия. Относительная влажность передаётся аналогичным образом, например 5000 означает 50.00 % влажности.

**Формат запросов:**

HTTP POST 

URL: /api/v1/имя_исполняющего_устройства/id

body:
```
{
    "temperature": 2500,
    "humidity": 5000,
}
```

**Формат ответов:**

HTTP 200 
<!-- [[[end]]] -->